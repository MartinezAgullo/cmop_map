<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CMOP ‚Äî Common Medical Operational Picture</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <link rel="stylesheet" href="/css/styles.css"/>
</head>
<body>
  <div class="app-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1>CMOP</h1>
        <p>Common Medical Operational Picture</p>
      </div>

      <div class="sidebar-content">

        <!-- ============================================================
             Scenario selector
             ============================================================ -->
        <div class="scenario-block">
          <label for="scenarioSelect">üé¨ Escenario</label>
          <div class="scenario-row">
            <select id="scenarioSelect">
              <option value="">Cargando escenarios‚Ä¶</option>
            </select>
            <button class="btn btn-scenario" id="loadScenarioBtn">Cargar</button>
          </div>
        </div>

        <!-- ============================================================
             Stats
             ============================================================ -->
        <div class="stats">
          <h3>üìä Estad√≠sticas</h3>
          <div class="stat-item">
            <span class="stat-label">Entidades:</span>
            <span class="stat-value" id="totalPuntos">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Categor√≠as:</span>
            <span class="stat-value" id="totalCategorias">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Casualties:</span>
            <span class="stat-value stat-casualties" id="totalCasualties">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Triage:</span>
            <span class="stat-value" id="triageCounts">
              <span class="triage-pill RED">0</span>
              <span class="triage-pill YELLOW">0</span>
              <span class="triage-pill GREEN">0</span>
            </span>
          </div>
        </div>

        <!-- ============================================================
             Filters
             ============================================================ -->
        <div class="controls">

          <!-- Category multi-select -->
          <div class="filter-section">
            <div class="filter-section-header" data-toggle="categoriesBody">
              <span>üè∑Ô∏è Categor√≠as</span>
              <div class="filter-section-actions">
                <button class="btn-clear" id="clearCategories" title="Limpiar">Limpiar</button>
                <span class="chevron">‚ñæ</span>
              </div>
            </div>
            <div class="filter-section-body" id="categoriesBody">
              <div class="checkbox-grid" id="categoryCheckboxes">
                <!-- Military -->
                <label class="filter-cb"><input type="checkbox" value="infantry" /><span>Infantry</span></label>
                <label class="filter-cb"><input type="checkbox" value="armoured" /><span>Armoured</span></label>
                <label class="filter-cb"><input type="checkbox" value="artillery" /><span>Artillery</span></label>
                <label class="filter-cb"><input type="checkbox" value="reconnaissance" /><span>Recon</span></label>
                <label class="filter-cb"><input type="checkbox" value="engineer" /><span>Engineer</span></label>
                <label class="filter-cb"><input type="checkbox" value="mortar" /><span>Mortar</span></label>
                <label class="filter-cb"><input type="checkbox" value="helicopter" /><span>Helicopter</span></label>
                <label class="filter-cb"><input type="checkbox" value="uav" /><span>UAV</span></label>
                <label class="filter-cb"><input type="checkbox" value="aircraft" /><span>Aircraft</span></label>
                <!-- Medical -->
                <label class="filter-cb filter-cb--medical"><input type="checkbox" value="casualty" /><span>ü©∏ Casualty</span></label>
                <label class="filter-cb filter-cb--medical"><input type="checkbox" value="medical_facility" /><span>üè• Med Facility</span></label>
                <label class="filter-cb filter-cb--medical"><input type="checkbox" value="medevac_unit" /><span>üöÅ MEDEVAC</span></label>
                <!-- Other military -->
                <label class="filter-cb"><input type="checkbox" value="missile" /><span>Missile</span></label>
                <label class="filter-cb"><input type="checkbox" value="fighter" /><span>Fighter</span></label>
                <label class="filter-cb"><input type="checkbox" value="bomber" /><span>Bomber</span></label>
                <label class="filter-cb"><input type="checkbox" value="ship" /><span>Ship</span></label>
                <label class="filter-cb"><input type="checkbox" value="destroyer" /><span>Destroyer</span></label>
                <label class="filter-cb"><input type="checkbox" value="submarine" /><span>Submarine</span></label>
                <label class="filter-cb"><input type="checkbox" value="ground_vehicle" /><span>Ground Veh.</span></label>
                <label class="filter-cb"><input type="checkbox" value="person" /><span>Person</span></label>
                <label class="filter-cb"><input type="checkbox" value="base" /><span>Base</span></label>
                <label class="filter-cb"><input type="checkbox" value="building" /><span>Building</span></label>
                <label class="filter-cb"><input type="checkbox" value="infrastructure" /><span>Infrastructure</span></label>
              </div>

              <!-- Casualty triage subfilter -->
              <div class="subfilter" id="subfilterCasualty" style="display:none;">
                <div class="subfilter-header">
                  <span>Triage Level</span>
                  <button class="btn-clear" id="clearTriageFilter">Limpiar</button>
                </div>
                <div class="subfilter-options" id="triageCheckboxes">
                  <label class="filter-cb triage-option">
                    <input type="checkbox" value="RED" />
                    <span class="triage-pill RED">T1 ‚Äî Immediate</span>
                  </label>
                  <label class="filter-cb triage-option">
                    <input type="checkbox" value="YELLOW" />
                    <span class="triage-pill YELLOW">T2 ‚Äî Urgent</span>
                  </label>
                  <label class="filter-cb triage-option">
                    <input type="checkbox" value="GREEN" />
                    <span class="triage-pill GREEN">T3 ‚Äî Minimal</span>
                  </label>
                  <label class="filter-cb triage-option">
                    <input type="checkbox" value="BLUE" />
                    <span class="triage-pill BLUE">T4 ‚Äî Expectant</span>
                  </label>
                  <label class="filter-cb triage-option">
                    <input type="checkbox" value="BLACK" />
                    <span class="triage-pill BLACK">Dead</span>
                  </label>
                  <label class="filter-cb triage-option">
                    <input type="checkbox" value="UNKNOWN" />
                    <span class="triage-pill UNKNOWN">Unknown</span>
                  </label>
                </div>
              </div>

              <!-- Medical facility role subfilter -->
              <div class="subfilter" id="subfilterMedFacility" style="display:none;">
                <div class="subfilter-header">
                  <span>Facility Role</span>
                  <button class="btn-clear" id="clearMedFacilityFilter">Limpiar</button>
                </div>
                <div class="subfilter-options" id="medFacilityCheckboxes">
                  <label class="filter-cb"><input type="checkbox" value="medical_role_1" /><span>Role 1 ‚Äî Aid Post</span></label>
                  <label class="filter-cb"><input type="checkbox" value="medical_role_2" /><span>Role 2 ‚Äî Surgical</span></label>
                  <label class="filter-cb"><input type="checkbox" value="medical_role_3" /><span>Role 3 ‚Äî Field Hospital</span></label>
                  <label class="filter-cb"><input type="checkbox" value="medical_role_4" /><span>Role 4 ‚Äî Definitive</span></label>
                  <label class="filter-cb"><input type="checkbox" value="medical_other" /><span>Other (R2B/R2E/Multi)</span></label>
                </div>
              </div>

              <!-- MEDEVAC role subfilter -->
              <div class="subfilter" id="subfilterMedevac" style="display:none;">
                <div class="subfilter-header">
                  <span>MEDEVAC Role</span>
                  <button class="btn-clear" id="clearMedevacFilter">Limpiar</button>
                </div>
                <div class="subfilter-options" id="medevacCheckboxes">
                  <label class="filter-cb"><input type="checkbox" value="medevac_role_1" /><span>Role 1 ‚Äî Immediate</span></label>
                  <label class="filter-cb"><input type="checkbox" value="medevac_role_2" /><span>Role 2 ‚Äî Forward</span></label>
                  <label class="filter-cb"><input type="checkbox" value="medevac_role_3" /><span>Role 3 ‚Äî Theater</span></label>
                  <label class="filter-cb"><input type="checkbox" value="medevac_role_4" /><span>Role 4 ‚Äî Definitive</span></label>
                  <label class="filter-cb"><input type="checkbox" value="medevac_other" /><span>Other (FW/Amb/Mech/Mort)</span></label>
                </div>
              </div>

            </div>
          </div>

          <!-- Alliance filter -->
          <div class="filter-section">
            <div class="filter-section-header" data-toggle="allianceBody">
              <span>üõ°Ô∏è Alianza</span>
              <div class="filter-section-actions">
                <button class="btn-clear" id="clearAlliance" title="Limpiar">Limpiar</button>
                <span class="chevron">‚ñæ</span>
              </div>
            </div>
            <div class="filter-section-body" id="allianceBody">
              <div class="checkbox-grid" id="allianceCheckboxes">
                <label class="filter-cb"><input type="checkbox" value="friendly" /><span class="alliance-dot" style="--dot-color:#00AEEF"></span><span>Friendly</span></label>
                <label class="filter-cb"><input type="checkbox" value="hostile" /><span class="alliance-dot" style="--dot-color:#FF0000"></span><span>Hostile</span></label>
                <label class="filter-cb"><input type="checkbox" value="neutral" /><span class="alliance-dot" style="--dot-color:#ADFF2F"></span><span>Neutral</span></label>
                <label class="filter-cb"><input type="checkbox" value="unknown" /><span class="alliance-dot" style="--dot-color:#A9A9A9"></span><span>Unknown</span></label>
              </div>
            </div>
          </div>

          <!-- Search -->
          <div class="filter-section">
            <div class="filter-section-header" data-toggle="searchBody">
              <span>üîç Buscar</span>
              <span class="chevron">‚ñæ</span>
            </div>
            <div class="filter-section-body" id="searchBody">
              <input type="text" id="buscarNombre" placeholder="Escribe un nombre‚Ä¶" class="search-input"/>
            </div>
          </div>

          <!-- Action buttons -->
          <div class="filter-actions">
            <button class="btn btn-primary" onclick="mostrarFormularioNuevoPunto()">‚ûï Nueva entidad</button>
            <button class="btn btn-secondary" onclick="centrarMapa()">üéØ Centrar en Espa√±a</button>
          </div>
        </div>

        <div id="message" class="message"></div>

        <!-- ============================================================
             Entity list
             ============================================================ -->
        <div class="puntos-list" id="puntosList">
          <p style="text-align:center;color:#999;">Cargando‚Ä¶</p>
        </div>
      </div>
    </aside>

    <!-- ================================================================
         Map
         ================================================================ -->
    <main class="map-container">
      <div id="map"></div>
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Cargando‚Ä¶</p>
      </div>
    </main>
  </div>

  <!-- ================================================================
       Modal ‚Äî create entity
       ================================================================ -->
  <div class="form-modal" id="formModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>‚ûï Nueva entidad</h2>
        <button class="close-btn" onclick="cerrarFormularioNuevoPunto()">&times;</button>
      </div>

      <form id="nuevoPuntoForm">
        <div class="form-group">
          <label for="nombre">Nombre *</label>
          <input type="text" id="nombre" name="nombre" required />
        </div>

        <div class="form-group">
          <label for="descripcion">Descripci√≥n</label>
          <textarea id="descripcion" name="descripcion"></textarea>
        </div>

        <div class="form-group">
          <label for="categoria">Categor√≠a *</label>
          <select id="categoria" name="categoria" required>
            <option value="">Selecciona una categor√≠a</option>

            <!-- Military -->
            <optgroup label="‚îÄ‚îÄ Military ‚îÄ‚îÄ">
              <option value="missile">missile ‚Äî Misil</option>
              <option value="fighter">fighter ‚Äî Caza</option>
              <option value="bomber">bomber ‚Äî Bombardero</option>
              <option value="aircraft">aircraft ‚Äî Aeronave</option>
              <option value="helicopter">helicopter ‚Äî Helic√≥ptero</option>
              <option value="uav">uav ‚Äî UAV/Drone</option>
              <option value="armoured">armoured ‚Äî Carro de Combate / Blindado</option>
              <option value="artillery">artillery ‚Äî Artiller√≠a</option>
              <option value="ship">ship ‚Äî Buque</option>
              <option value="destroyer">destroyer ‚Äî Destructor</option>
              <option value="submarine">submarine ‚Äî Submarino</option>
              <option value="ground_vehicle">ground_vehicle ‚Äî Veh√≠culo Terrestre</option>
              <option value="infantry">infantry ‚Äî Infanter√≠a</option>
              <option value="reconnaissance">reconnaissance ‚Äî Reconocimiento / Caballer√≠a</option>
              <option value="engineer">engineer ‚Äî Ingenieros</option>
              <option value="mortar">mortar ‚Äî Mortero</option>
              <option value="person">person ‚Äî Persona</option>
              <option value="base">base ‚Äî Base</option>
              <option value="building">building ‚Äî Edificio</option>
              <option value="infrastructure">infrastructure ‚Äî Infraestructura</option>
            </optgroup>

            <!-- Medical & MEDEVAC -->
            <optgroup label="‚îÄ‚îÄ Medical & MEDEVAC ‚îÄ‚îÄ">
              <option value="medical_facility">medical_facility ‚Äî Medical Facility</option>
              <option value="medevac_unit">medevac_unit ‚Äî MEDEVAC Asset</option>
            </optgroup>

            <!-- Casualties -->
            <optgroup label="‚îÄ‚îÄ Casualties ‚îÄ‚îÄ">
              <option value="casualty">casualty ‚Äî Casualty</option>
            </optgroup>

            <option value="default">default</option>
          </select>
        </div>

        <!-- Tipo Elemento (dynamic, shown only for medical_facility, medevac_unit) -->
        <div class="form-group" id="tipoElementoGroup" style="display:none;">
          <label for="tipoElemento">Tipo Elemento *</label>
          <select id="tipoElemento" name="tipoElemento">
            <option value="">‚Äî Selecciona tipo ‚Äî</option>
          </select>
        </div>

        <div class="form-group">
          <label for="country">Country</label>
          <input type="text" id="country" name="country" placeholder="Spain, France‚Ä¶"/>
        </div>

        <div class="form-group">
          <label for="alliance">Alliance *</label>
          <select id="alliance" name="alliance" required>
            <option value="friendly">friendly</option>
            <option value="hostile">hostile</option>
            <option value="neutral">neutral</option>
            <option value="unknown" selected>unknown</option>
          </select>
        </div>

        <div style="display:flex;gap:10px;">
          <div class="form-group" style="flex:1;">
            <label for="latitud">Latitud *</label>
            <input type="number" id="latitud" name="latitud" step="any" required />
          </div>
          <div class="form-group" style="flex:1;">
            <label for="longitud">Longitud *</label>
            <input type="number" id="longitud" name="longitud" step="any" required />
          </div>
        </div>

        <div style="display:flex;gap:10px;margin-top:10px;">
          <button type="submit" class="btn btn-primary">Guardar</button>
          <button type="button" class="btn btn-secondary" onclick="cerrarFormularioNuevoPunto()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>
